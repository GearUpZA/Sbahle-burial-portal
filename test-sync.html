<!DOCTYPE html>
<html>
<head>
    <title>Test JSONBin Sync</title>
</head>
<body>
    <h1>Testing JSONBin Sync</h1>
    <button onclick="testRead()">Test Read from Cloud</button>
    <button onclick="testWrite()">Test Write to Cloud</button>
    <pre id="output"></pre>

    <script>
        const CLOUD_STORAGE = {
            binId: '69032dadd0ea881f40c6cfd5',
            apiKey: '$2a$10$LUKvn7ZMDSlDEbqAM45V7ub0iXv2sLBAIH9bqLD7IvyGNJvwFWAne',
            endpoint: 'https://api.jsonbin.io/v3/b'
        };

        function log(msg) {
            document.getElementById('output').textContent += msg + '\n';
            console.log(msg);
        }

        async function testRead() {
            document.getElementById('output').textContent = '';
            log('üîÑ Testing read from JSONBin...');
            
            try {
                const response = await fetch(`${CLOUD_STORAGE.endpoint}/${CLOUD_STORAGE.binId}/latest`, {
                    headers: {
                        'X-Access-Key': CLOUD_STORAGE.apiKey
                    }
                });
                
                if (response.ok) {
                    const result = await response.json();
                    const data = result.record;
                    log('‚úÖ READ SUCCESS!');
                    log(`Members: ${data.members?.length || 0}`);
                    log(`Beneficiaries: ${data.beneficiaries?.length || 0}`);
                    log(`Version: ${data.version}`);
                    log(`Last saved: ${data.lastSaved}`);
                    log('\nFull data:');
                    log(JSON.stringify(data, null, 2));
                } else {
                    log('‚ùå READ FAILED: ' + response.status);
                    const error = await response.text();
                    log('Error: ' + error);
                }
            } catch (error) {
                log('‚ùå ERROR: ' + error.message);
            }
        }

        async function testWrite() {
            document.getElementById('output').textContent = '';
            log('üîÑ Testing write to JSONBin...');
            
            const testData = {
                members: [
                    { id: 'TEST001', name: 'Test User', email: 'test@test.com' }
                ],
                beneficiaries: [],
                payouts: [],
                penalties: [],
                meetingMinutes: [],
                paymentProofs: [],
                payoutCollectors: [],
                version: '2.9.0-test',
                lastSaved: new Date().toISOString()
            };
            
            try {
                const response = await fetch(`${CLOUD_STORAGE.endpoint}/${CLOUD_STORAGE.binId}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Access-Key': CLOUD_STORAGE.apiKey
                    },
                    body: JSON.stringify(testData)
                });
                
                if (response.ok) {
                    log('‚úÖ WRITE SUCCESS!');
                    log('Test data written to cloud');
                    log('Now click "Test Read" to verify');
                } else {
                    log('‚ùå WRITE FAILED: ' + response.status);
                    const error = await response.text();
                    log('Error: ' + error);
                }
            } catch (error) {
                log('‚ùå ERROR: ' + error.message);
            }
        }
    </script>
</body>
</html>
